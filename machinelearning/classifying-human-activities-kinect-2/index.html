<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Recognizing Human Activities with Kinect - The implementation &#8211; Avi Singh</title>
<meta name="description" content="">
<meta name="keywords" content="machinelearning,, computervision,, kinect,, classification,, hcrf">


<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Recognizing Human Activities with Kinect - The implementation">
<meta property="og:description" content="The personal webpage and weblog of Avi Singh.">
<meta property="og:url" content="/machinelearning/classifying-human-activities-kinect-2/">
<meta property="og:site_name" content="Avi Singh">





<link rel="canonical" href="/machinelearning/classifying-human-activities-kinect-2/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Avi Singh Feed">
<link rel="author" href="http://plus.google.com/+avisingh599?rel=author">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Google Webfonts -->
<link href='http://fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700|PT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>
<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.min.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63278661-1', 'auto');
  ga('send', 'pageview');

</script>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="">Avi Singh</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				<li><a href="/" >Home</a></li>
		        
				<li><a href="/research/" >Research</a></li>
		        
				<li><a href="/projects/" >Projects</a></li>
		        
				<li><a href="/assets/cv.pdf" >Resume</a></li>
		        
				<li><a href="/blog/" >Blog</a></li>
		        
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    
	<img src="/images/bio-photo.jpg" class="bio-photo" alt="Avi Singh bio photo"></a>

<h3>Avi Singh</h3>
<p>Undergraduate, interested in Computer Vision and Machine Learning</p>

<a href="http://facebook.com/avisingh94" class="author-social" target="_blank"><i class="fa fa-facebook-square"></i> Facebook</a>
<a href="http://linkedin.com/pub/avi-singh/7b/444/681" class="author-social" target="_blank"><i class="fa fa-linkedin-square"></i> LinkedIn</a>

<a href="http://plus.google.com/+avisingh599" class="author-social" target="_blank"><i class="fa fa-google-plus-square"></i> Google+</a>



<a href="http://github.com/avisingh599" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>






  </div>
  <article>
    <div class="headline-wrap">
      
        <h1><a href="/machinelearning/classifying-human-activities-kinect-2/" rel="bookmark" title="Recognizing Human Activities with Kinect - The implementation">Recognizing Human Activities with Kinect - The implementation</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <p><em>Disclaimer: The work described in this post was done by me and my classmate at IIT-Kanpur, Ankit Goyal. <a href="/assets/activity-classification.pdf">Here</a> is a link to the presentation that we gave.</em></p>

<p>This is a follow up of my earlier <a href="/machinelearning/classifying-human-activities-kinect/">post</a>, in which I explored
temporal models, that can be applied to things like part-of-speech tagging, gesture recognition, and any sequential 
or temporal sources of data in general. In this post, I will describe in more detail the implementation of our
project that classified RGBD videos according to the activity being performed in them.</p>

<h3 id="dataset">Dataset</h3>
<p>Quite a few <a href="http://research.microsoft.com/en-us/um/people/zliu/ActionRecoRsrc/">RGBD datasets</a> 
are available for human activity detection/classification, and we chose to use the 
MSR Daily Activity 3D dataset. Since we had limited computational resources (the mathserver of IITK),
and a limited time before the submission deadline, we chose to use a subset of the above dataset, 
and worked with only 6 activities. So, our problem was now reduced to 6-class classification.</p>

<h3 id="features">Features</h3>
<p>In any machine learning problem, your model or learning algorithm is useless without a good set of
features. I read a <a href="http://www.sciencedirect.com/science/article/pii/S0167865514001299">recent paper</a> which
had a decent review of the various features used. They were:</p>

<ol>
  <li>3D silhouettes - Finding the outline of the human body, and using the shape of this outline as features.</li>
  <li>Skeletal joints or body part tracking - Kinect comes with an algorithm to determine the pose of the body
from the depth image alone. Pose here refers to the 3D coordinates of 15 body joints. </li>
  <li>Local Spatio-temporal features - Just like some 2D/3D image feature detector, but with the added dimension of time.</li>
  <li>Local 3D occupancy features - This one seemed the most interesting. What this does is to treat an RGBD video as
a function I(x, y, z, t). Now, this a very sparse function, and would be zero at most points in a 4D space. But, 
whenever a certain activity is performed, certain regions of this 4D space will become filled. Inferring from 
such data is now a matter sampling it efficiently, and this where all the innovation must lie, if this technique 
is to work.</li>
  <li>3D optical flow - The 3D counter part of the popular <a href="http://en.wikipedia.org/wiki/Optical_flow">optical flow</a>, 
it is also known as [Scene Flow] in the academic literature. <a href="http://www.sciencedirect.com/science/article/pii/S1077314210001748">This</a> 
is one paper that makes use of these features.</li>
</ol>

<p>The features that we ultimately went ahead were the skeletal joints. The MSR Daily Activity 3D dataset already provides
the skeletal joint coordinates to us, so all we had to was to take that data, and do some basic pre-processing on it.</p>

<h4 id="preprocessing-the-features">Preprocessing the features.</h4>

<p>The dataset provides us with the 3D coordinates of 15 human body joints. These cordinates are in the frame of reference of the Kinect.
The first operation that we perform on them is the following: to transform the points from the Kinect reference frame to the frame
of the person. By frame of the person, we refer to the joint corresponding to the torso.</p>

<p>Next thing that we do is what we call “body size normalization”. Basically all the body lengths, such as the distance between the elbo and 
hand, are scaled up or down to a standard body size. This ensures that the variation in bosy sizes is captured at the feature level itself,
and our model does not have to worry about it anymore. </p>

<p>Here’s the code that reads the skeleton files from the MSR dataset, and performs the feature extraction part:</p>

<div class="highlight"><pre><code class="matlab"><span class="n">label</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">testr</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">trainr</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span>
<span class="n">trainsequence</span><span class="p">=</span><span class="n">cell</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">);</span>
<span class="n">trainlabel</span><span class="p">=</span><span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">48</span><span class="p">);</span>
<span class="n">testsequence</span><span class="p">=</span><span class="n">cell</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">);</span>
<span class="n">testlabel</span><span class="p">=</span><span class="nb">ones</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">);</span>
<span class="k">for</span> <span class="nb">j</span><span class="p">=[</span><span class="mi">1</span> <span class="mi">4</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">10</span> <span class="mi">15</span><span class="p">]</span>         <span class="c">%% Set the Activity Number which you want to extract</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">j</span><span class="o">==</span><span class="mi">13</span><span class="o">||</span><span class="nb">j</span><span class="o">==</span><span class="mi">14</span><span class="p">)</span>
        <span class="k">continue</span><span class="p">;</span>
    <span class="k">end</span>
<span class="k">for</span> <span class="nb">i</span><span class="p">=</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span><span class="p">]</span> <span class="c">%% Set the Person Number for whom you want to extaract data               </span>
 <span class="k">for</span> <span class="n">k</span><span class="p">=[</span><span class="mi">1</span><span class="p">]</span>                    <span class="c">%% Set which sequence of the activity you want to extract</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">j</span><span class="o">&lt;</span><span class="p">=</span><span class="mi">9</span><span class="p">)</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">i</span><span class="o">&lt;</span><span class="p">=</span><span class="mi">9</span><span class="p">)</span>
                <span class="n">a</span><span class="p">=</span><span class="n">strcat</span><span class="p">(</span><span class="s">&#39;a0&#39;</span><span class="p">,</span><span class="n">int2str</span><span class="p">(</span><span class="nb">j</span><span class="p">),</span><span class="s">&#39;_s0&#39;</span><span class="p">,</span><span class="n">int2str</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="s">&#39;_e0&#39;</span><span class="p">,</span><span class="n">int2str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="s">&#39;_skeleton.txt&#39;</span><span class="p">);</span>
            <span class="k">else</span>
                <span class="n">a</span><span class="p">=</span><span class="n">strcat</span><span class="p">(</span><span class="s">&#39;a0&#39;</span><span class="p">,</span><span class="n">int2str</span><span class="p">(</span><span class="nb">j</span><span class="p">),</span><span class="s">&#39;_s10&#39;</span><span class="p">,</span><span class="s">&#39;_e0&#39;</span><span class="p">,</span><span class="n">int2str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="s">&#39;_skeleton.txt&#39;</span><span class="p">);</span>
            <span class="k">end</span>
        <span class="k">else</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">i</span><span class="o">&lt;</span><span class="p">=</span><span class="mi">9</span><span class="p">)</span>
               <span class="n">a</span><span class="p">=</span><span class="n">strcat</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="n">int2str</span><span class="p">(</span><span class="nb">j</span><span class="p">),</span><span class="s">&#39;_s0&#39;</span><span class="p">,</span><span class="n">int2str</span><span class="p">(</span><span class="nb">i</span><span class="p">),</span><span class="s">&#39;_e0&#39;</span><span class="p">,</span><span class="n">int2str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="s">&#39;_skeleton.txt&#39;</span><span class="p">);</span>
            <span class="k">else</span>
               <span class="n">a</span><span class="p">=</span><span class="n">strcat</span><span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="n">int2str</span><span class="p">(</span><span class="nb">j</span><span class="p">),</span><span class="s">&#39;_s10&#39;</span><span class="p">,</span><span class="s">&#39;_e0&#39;</span><span class="p">,</span><span class="n">int2str</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="s">&#39;_skeleton.txt&#39;</span><span class="p">);</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="n">b</span><span class="p">=</span><span class="n">dlmread</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
    <span class="n">frames</span><span class="p">=</span><span class="n">b</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">data</span><span class="p">=</span><span class="nb">ones</span><span class="p">(</span><span class="mi">20</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="n">frames</span><span class="p">);</span>
    <span class="n">start_index</span><span class="p">=</span><span class="mi">3</span><span class="p">;</span>
    <span class="n">torso_initial</span><span class="p">=</span><span class="n">b</span><span class="p">(</span><span class="mi">3</span><span class="p">,[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">]);</span>
    <span class="n">torso_initial</span> <span class="p">=</span> <span class="nb">ones</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">torso_initial</span><span class="p">);</span>
    <span class="n">crr_frame</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">crr_data</span><span class="p">=</span><span class="nb">ones</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">bone_vectors</span><span class="p">=</span><span class="nb">ones</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="n">final_position</span><span class="p">=</span><span class="nb">ones</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
    <span class="k">while</span><span class="p">(</span><span class="n">crr_frame</span><span class="o">&lt;</span><span class="n">frames</span><span class="p">)</span>
    <span class="n">crr_data</span><span class="p">=</span><span class="n">b</span><span class="p">(</span><span class="n">start_index</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">start_index</span><span class="o">+</span><span class="mi">38</span><span class="p">,[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]);</span>
    <span class="n">relative_position</span> <span class="p">=</span> <span class="n">crr_data</span> <span class="o">-</span> <span class="n">torso_initial</span><span class="p">;</span>
    <span class="n">rearranged_position</span> <span class="p">=</span> <span class="n">relative_position</span><span class="p">([</span><span class="mi">1</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">3</span> <span class="mi">9</span> <span class="mi">10</span> <span class="mi">11</span> <span class="mi">1</span> <span class="mi">13</span> <span class="mi">14</span> <span class="mi">15</span> <span class="mi">1</span> <span class="mi">17</span> <span class="mi">18</span> <span class="mi">19</span><span class="p">],:);</span>
    <span class="n">bone_vectors</span> <span class="p">=</span> <span class="n">relative_position</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">20</span><span class="p">,:)</span> <span class="o">-</span> <span class="n">rearranged_position</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">20</span><span class="p">,:);</span>
    <span class="n">segment_length</span> <span class="p">=</span> <span class="nb">sqrt</span><span class="p">((</span><span class="n">sum</span><span class="p">((</span><span class="n">bone_vectors</span><span class="o">.*</span><span class="n">bone_vectors</span><span class="p">)</span><span class="o">&#39;</span><span class="p">))</span><span class="o">&#39;</span><span class="p">);</span>    
    <span class="nb">factor</span><span class="p">=(</span><span class="mf">1.</span><span class="o">/</span><span class="n">segment_length</span><span class="p">)</span><span class="o">.*</span><span class="p">([.</span><span class="mi">05</span><span class="p">;.</span><span class="mi">21</span><span class="p">;.</span><span class="mi">12</span><span class="p">;.</span><span class="mi">13</span><span class="p">;.</span><span class="mi">186</span><span class="p">;.</span><span class="mi">146</span><span class="p">;.</span><span class="mi">054</span><span class="p">;.</span><span class="mi">13</span><span class="p">;.</span><span class="mi">186</span><span class="p">;.</span><span class="mi">146</span><span class="p">;.</span><span class="mi">054</span><span class="p">;.</span><span class="mi">1</span><span class="p">;.</span><span class="mi">245</span><span class="p">;.</span><span class="mi">246</span><span class="p">;.</span><span class="mi">08</span><span class="p">;.</span><span class="mi">1</span><span class="p">;.</span><span class="mi">245</span><span class="p">;.</span><span class="mi">246</span><span class="p">;.</span><span class="mi">08</span><span class="p">]);</span>
    <span class="n">factor2</span> <span class="p">=</span> <span class="p">[</span><span class="nb">factor</span><span class="p">,</span><span class="nb">factor</span><span class="p">,</span><span class="nb">factor</span><span class="p">];</span>
    <span class="n">scaled_bone_vector</span> <span class="p">=</span> <span class="n">bone_vectors</span><span class="o">.*</span><span class="n">factor2</span><span class="p">;</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)=</span><span class="n">relative_position</span><span class="p">(</span><span class="mi">1</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">2</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">1</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">3</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">2</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">2</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">4</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">3</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">3</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">5</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">3</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">4</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">6</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">5</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">5</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">7</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">6</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">6</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">8</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">7</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">7</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">9</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">3</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">8</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">10</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">9</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">9</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">11</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">10</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">10</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">12</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">11</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">11</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">13</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">12</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">14</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">13</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">13</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">15</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">14</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">14</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">16</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">15</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">15</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">17</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">1</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">16</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">18</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">17</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">17</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">19</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">18</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">18</span><span class="p">,:);</span>
    <span class="n">final_position</span><span class="p">(</span><span class="mi">20</span><span class="p">,:)=</span><span class="n">final_position</span><span class="p">(</span><span class="mi">19</span><span class="p">,:)</span><span class="o">+</span><span class="n">scaled_bone_vector</span><span class="p">(</span><span class="mi">19</span><span class="p">,:);</span>
    <span class="n">data</span><span class="p">(:,</span><span class="n">crr_frame</span><span class="o">+</span><span class="mi">1</span><span class="p">)=</span><span class="n">final_position</span><span class="p">(:);</span>
    <span class="n">crr_frame</span><span class="p">=</span><span class="n">crr_frame</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">start_index</span><span class="p">=</span><span class="n">start_index</span><span class="o">+</span><span class="mi">41</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="n">new_data</span><span class="p">=</span><span class="nb">ones</span><span class="p">(</span><span class="mi">120</span><span class="p">,</span><span class="n">frames</span><span class="p">);</span>
    <span class="n">new_data</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">60</span><span class="p">,:)=</span><span class="n">data</span><span class="p">;</span>
    <span class="n">new_data</span><span class="p">(</span><span class="mi">61</span><span class="p">:</span><span class="mi">120</span><span class="p">,</span><span class="mi">1</span><span class="p">)=</span><span class="nb">zeros</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">new_data</span><span class="p">(</span><span class="mi">61</span><span class="p">:</span><span class="mi">120</span><span class="p">,</span><span class="mi">2</span><span class="p">:</span><span class="n">frames</span><span class="p">)=</span><span class="n">data</span><span class="p">(:,</span><span class="mi">2</span><span class="p">:</span><span class="n">frames</span><span class="p">)</span><span class="o">-</span><span class="n">data</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="n">frames</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="c">%if(j&lt;=12)</span>
     <span class="c">%   label=j-1;</span>
    <span class="c">%else</span>
     <span class="c">%   label=j-3;</span>
    <span class="c">%end </span>
    <span class="k">switch</span><span class="p">(</span><span class="nb">j</span><span class="p">)</span>
        <span class="k">case</span> <span class="mi">1</span> 
            <span class="n">label</span><span class="p">=</span><span class="mi">0</span><span class="p">;</span>
           <span class="c">% break;</span>
        <span class="k">case</span> <span class="mi">4</span>
            <span class="n">label</span><span class="p">=</span><span class="mi">1</span><span class="p">;</span>
           <span class="c">% break;</span>
        <span class="k">case</span> <span class="mi">7</span>
            <span class="n">label</span><span class="p">=</span><span class="mi">2</span><span class="p">;</span>
           <span class="c">% break;</span>
        <span class="k">case</span> <span class="mi">8</span>
            <span class="n">label</span><span class="p">=</span><span class="mi">3</span><span class="p">;</span>
           <span class="c">% break;    </span>
        <span class="k">case</span> <span class="mi">10</span>
            <span class="n">label</span><span class="p">=</span><span class="mi">4</span><span class="p">;</span>
            <span class="c">%break;</span>
        <span class="k">case</span> <span class="mi">15</span>
            <span class="n">label</span><span class="p">=</span><span class="mi">5</span><span class="p">;</span>
    <span class="k">end</span>
 <span class="c">%   disp(&#39;this is alright&#39;);</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">i</span><span class="o">&gt;</span><span class="p">=</span><span class="mi">3</span><span class="p">)</span>                                           <span class="c">%% Set the Person Number you want to put in the train sequence </span>
        <span class="n">trainsequence</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="n">trainr</span><span class="p">}=</span><span class="n">new_data</span><span class="p">;</span>
        <span class="n">trainlabel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">trainr</span><span class="p">)=</span><span class="n">label</span><span class="p">;</span>
        <span class="n">trainr</span><span class="p">=</span><span class="n">trainr</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span>                                               <span class="c">%% Rest all person are put in the test sequence</span>
        <span class="n">testsequence</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="n">testr</span><span class="p">}=</span><span class="n">new_data</span><span class="p">;</span>
        <span class="n">testlabel</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">testr</span><span class="p">)=</span><span class="n">label</span><span class="p">;</span>
        <span class="n">testr</span><span class="p">=</span><span class="n">testr</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span>
   <span class="c">% save(strcat(&#39;a02_s10_e01_skeleton_data&#39;),&#39;data&#39;);</span>
   <span class="c">% save(strcat(&#39;a02_s0&#39;,int2str(i),&#39;_e02_skeleton_data&#39;),&#39;data&#39;);</span>
    
 <span class="k">end</span>
<span class="k">end</span>
<span class="k">end</span></code></pre></div>

<h3 id="model">Model</h3>

<p>Now, as I discussed in my <a href="/machinelearning/classifying-human-activities-kinect/">previous post</a>, Hidden Conditional
Random Fields (HCRFs) was the model that we finally selected. The original authors had released a well documented 
<a href="http://sourceforge.net/projects/hcrf/">toolbox</a>, to which we directly fed the features that were computed above.</p>

<h3 id="results">Results</h3>
<p>Five-fold cross-validation without any hyper-parameter tuning yielded a precision of 71%. These results do not seem impressive
on first glance, but it must be noted that all our experiments were performed in the “new person” setting i.e. the person in the
test set did not appear in the training set, and we did not do any hyper parameter tuning. Our results can be summarised in the 
ollowing heatmap:</p>

<figure>
	<img src="/images/kinect_activity/heatmap.bmp" />
	<figcaption>Where the algorithm succeeds and fails</figcaption>
</figure>

<p>The above figure made one thing clear: that accuracy is being seriously harmed by the algorithm’s inability
to correctly distinguish between drinking and talking on phone. The reason for this is relatively simple. 
The features that we are using are skeletal features, and therefore we do not pay any attention to what
objects the human is interacting with. If you look at the skelat stream, talking on the phone, and drinking
water seem extrmemly similar! In both the cases, the human raises a hand, and brings it near his head. 
Thus, in order to make a truly useful activity detection system, it is important to model these interactions
explicitly. </p>

<p>If we do get around to improving this model, I will post it here. </p>


      <hr />
      <footer role="contentinfo">
        <div class="article-author-bottom">
          
	<img src="/images/bio-photo.jpg" class="bio-photo" alt="Avi Singh bio photo"></a>

<h3>Avi Singh</h3>
<p>Undergraduate, interested in Computer Vision and Machine Learning</p>

<a href="http://facebook.com/avisingh94" class="author-social" target="_blank"><i class="fa fa-facebook-square"></i> Facebook</a>
<a href="http://linkedin.com/pub/avi-singh/7b/444/681" class="author-social" target="_blank"><i class="fa fa-linkedin-square"></i> LinkedIn</a>

<a href="http://plus.google.com/+avisingh599" class="author-social" target="_blank"><i class="fa fa-google-plus-square"></i> Google+</a>



<a href="http://github.com/avisingh599" class="author-social" target="_blank"><i class="fa fa-github"></i> Github</a>






        </div>
        <p class="byline"><strong>Recognizing Human Activities with Kinect - The implementation</strong> was published on <time datetime="2015-06-02T00:00:00+00:00">June 02, 2015</time> by <a href="/about" title="About Avi Singh">Avi Singh</a>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/posts/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/vision/monocular-vo/" title="Monocular Visual Odometry using OpenCV">Monocular Visual Odometry using OpenCV</a></li>
    
      <li><a href="/machinelearning/classifying-human-activities-kinect/" title="Recognizing Human Activities with Kinect - Choosing a temporal model">Recognizing Human Activities with Kinect - Choosing a temporal model</a></li>
    
      <li><a href="/vision/visual-odometry-full/" title="Visual Odmetry from scratch - A tutorial for beginners">Visual Odmetry from scratch - A tutorial for beginners</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  <footer>
    <span>&copy; 2015 Avi Singh. Powered by <a href="http://jekyllrb.com">Jekyll</a> using the <a href="http://mademistakes.com/minimal-mistakes/">Minimal Mistakes</a> theme.</span>

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'avisingh599'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

	        

</body>
</html>